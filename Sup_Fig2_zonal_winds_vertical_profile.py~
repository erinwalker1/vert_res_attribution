# -*- coding: utf-8 -*-
"""
Created on Mon Feb 22 17:05:04 2021

@author: at18707
"""

# -*- coding: utf-8 -*-
"""
Created on Thu Feb 18 17:03:07 2021

@author: at18707
"""

# -*- coding: utf-8 -*-
"""
Created on Thu Feb 18 15:26:38 2021

@author: at18707
"""
import matplotlib.pyplot as plt
import numpy as np
import xarray as xr

p_file_c = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\control\\daily_ensmean.nc",chunks={'time':30})
f_file_c = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\3deg\\50_ens\\daily_ensmean_3deg_c.nc")

p_file_da = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\double_all\\daily_ensmean.nc",chunks={'time':30})
f_file_da = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\3deg\\50_ens\\daily_ensmean_3deg_da.nc")

p_file_dt = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\double_tropo\\daily_ensmean.nc",chunks={'time':30})
f_file_dt = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\3deg\\50_ens\\daily_ensmean_3deg_dt.nc")

p_file_ns = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\no_strat\\daily_ensmean.nc",chunks={'time':30})
f_file_ns = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\3deg\\50_ens\\daily_ensmean_3deg_ns.nc")

p_file_q = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\quadruple\\daily_ensmean.nc",chunks={'time':30})
f_file_q = xr.open_dataset("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\3deg\\50_ens\\daily_ensmean_3deg_q.nc")


###############################################
## Zonal mean Wind Profile Difference ##
###############################################
p_uwind_z_c = p_file_c.ucomp.sel(lat=slice(0,90)).mean(('lon'))
f_uwind_z_c = f_file_c.ucomp.sel(lat=slice(0,90)).mean(('lon'))

p_uwind_z_da = p_file_da.ucomp.sel(lat=slice(0,90)).mean(('lon'))
f_uwind_z_da = f_file_da.ucomp.sel(lat=slice(0,90)).mean(('lon'))

p_uwind_z_dt = p_file_dt.ucomp.sel(lat=slice(0,90)).mean(('lon'))
f_uwind_z_dt = f_file_dt.ucomp.sel(lat=slice(0,90)).mean(('lon'))

p_uwind_z_ns = p_file_ns.ucomp.sel(lat=slice(0,90)).mean(('lon'))
f_uwind_z_ns = f_file_ns.ucomp.sel(lat=slice(0,90)).mean(('lon'))

p_uwind_z_q = p_file_q.ucomp.sel(lat=slice(0,90)).mean(('lon'))
f_uwind_z_q = f_file_q.ucomp.sel(lat=slice(0,90)).mean(('lon'))


#Check shapes are the same
print(p_uwind_z_c.shape, f_uwind_z_c.shape,
      p_uwind_z_da.shape, f_uwind_z_da.shape,
      p_uwind_z_dt.shape, f_uwind_z_dt.shape,
      p_uwind_z_ns.shape, f_uwind_z_ns.shape,
      p_uwind_z_q.shape, f_uwind_z_q.shape)

#Difference of 3deg from present 
diff_ucomp_z_c = f_uwind_z_c - p_uwind_z_c
diff_ucomp_z_da = f_uwind_z_da - p_uwind_z_da
diff_ucomp_z_dt = f_uwind_z_dt - p_uwind_z_dt
diff_ucomp_z_ns = f_uwind_z_ns - p_uwind_z_ns
diff_ucomp_z_q = f_uwind_z_q - p_uwind_z_q

#Difference of difference from control
diff_ucomp_z_c_da = diff_ucomp_z_da - diff_ucomp_z_c
diff_ucomp_z_c_dt = diff_ucomp_z_dt - diff_ucomp_z_c
diff_ucomp_z_c_ns = diff_ucomp_z_ns - diff_ucomp_z_c
diff_ucomp_z_c_q = diff_ucomp_z_q - diff_ucomp_z_c


fig ,ax = plt.subplots(ncols=5,nrows=3,figsize=((13,10)),sharex=True,sharey=True)

#DECEMBER
c1 = diff_ucomp_z_c.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[0,0])
c = p_uwind_z_c.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[0,0])

c2 = diff_ucomp_z_c_da.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[0,1],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_da.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[0,1])

diff_ucomp_z_c_q.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[0,2],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_q.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[0,2])

diff_ucomp_z_c_dt.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[0,3],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_dt.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[0,3])

diff_ucomp_z_c_ns.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[0,4],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_ns.sel(time=slice('0001-12-01','0001-12-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[0,4])

#JANUARY
diff_ucomp_z_c.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[1,0])
p_uwind_z_c.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[1,0])

diff_ucomp_z_c_da.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[1,1],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_da.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[1,1])

diff_ucomp_z_c_q.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[1,2],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_q.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[1,2])

diff_ucomp_z_c_dt.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[1,3],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_dt.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[1,3])

diff_ucomp_z_c_ns.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[1,4],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_ns.sel(time=slice('0002-01-01','0002-01-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[1,4])

#FEBRUARY
diff_ucomp_z_c.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[2,0])
p_uwind_z_c.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[2,0])

diff_ucomp_z_c_da.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[2,1],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_da.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[2,1])

diff_ucomp_z_c_q.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[2,2],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_q.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[2,2])

diff_ucomp_z_c_dt.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[2,3],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_dt.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[2,3])

diff_ucomp_z_c_ns.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contourf(yincrease=False, yscale='log',levels=21,add_colorbar=False,ax=ax[2,4],vmin=-8,vmax=8,cmap='RdBu_r')
p_uwind_z_ns.sel(time=slice('0002-02-01','0002-02-30'),pfull=slice(1,1000)).mean(('time')).plot.contour(yincrease=False, yscale='log',levels=21,colors='grey',linewidths=1,ax=ax[2,4])


ylabels=['1000','100','10','1']
yticks=[1000,100,10,1]
 
ax[0,0].set_yticks(yticks)
ax[0,0].set_yticklabels(ylabels)
ax[0,0].set_ylabel('Pressure, hPa',fontsize=12)
ax[0,0].set_xlabel('')
ax[0,0].set_title('Control',fontsize=12)

ax[0,1].set_yticks(yticks)
ax[0,1].set_yticklabels(ylabels)
ax[0,1].set_ylabel('')
ax[0,1].set_xlabel('')
ax[0,1].set_title('Double All - Control',fontsize=12)

ax[0,2].set_yticks(yticks)
ax[0,2].set_yticklabels(ylabels)
ax[0,2].set_ylabel('')
ax[0,2].set_xlabel('')
ax[0,2].set_title('Quadruple All - Control',fontsize=12)

ax[0,3].set_yticks(yticks)
ax[0,3].set_yticklabels(ylabels)
ax[0,3].set_ylabel('')
ax[0,3].set_xlabel('')
ax[0,3].set_title('Double Tropo - Control',fontsize=12)

ax[0,4].set_yticks(yticks)
ax[0,4].set_yticklabels(ylabels)
ax[0,4].set_ylabel('')
ax[0,4].set_xlabel('')
ax[0,4].set_title('No Strat - Control',fontsize=12)

ax[1,0].set_yticks(yticks)
ax[1,0].set_yticklabels(ylabels)
ax[1,0].set_ylabel('Pressure, hPa',fontsize=12)
ax[1,0].set_xlabel('')
ax[1,0].set_title('')

ax[1,1].set_yticks(yticks)
ax[1,1].set_yticklabels(ylabels)
ax[1,1].set_ylabel('')
ax[1,1].set_xlabel('')
ax[1,1].set_title('')

ax[1,2].set_yticks(yticks)
ax[1,2].set_yticklabels(ylabels)
ax[1,2].set_ylabel('')
ax[1,2].set_xlabel('')
ax[1,2].set_title('')

ax[1,3].set_yticks(yticks)
ax[1,3].set_yticklabels(ylabels)
ax[1,3].set_ylabel('')
ax[1,3].set_xlabel('')
ax[1,3].set_title('')

ax[1,4].set_yticks(yticks)
ax[1,4].set_yticklabels(ylabels)
ax[1,4].set_ylabel('')
ax[1,4].set_xlabel('')
ax[1,4].set_title('')

ax[2,0].set_yticks(yticks)
ax[2,0].set_yticklabels(ylabels)
ax[2,0].set_ylabel('Pressure, hPa',fontsize=12)
ax[2,0].set_xlabel('Latitude, $^\circ$N',fontsize=12)
ax[2,0].set_title('')

ax[2,1].set_yticks(yticks)
ax[2,1].set_yticklabels(ylabels)
ax[2,1].set_ylabel('')
ax[2,1].set_xlabel('Latitude, $^\circ$N',fontsize=12)
ax[2,1].set_title('')

ax[2,2].set_yticks(yticks)
ax[2,2].set_yticklabels(ylabels)
ax[2,2].set_ylabel('')
ax[2,2].set_xlabel('Latitude, $^\circ$N',fontsize=12)
ax[2,2].set_title('')

ax[2,3].set_yticks(yticks)
ax[2,3].set_yticklabels(ylabels)
ax[2,3].set_ylabel('')
ax[2,3].set_xlabel('Latitude, $^\circ$N',fontsize=12)
ax[2,3].set_title('')

ax[2,4].set_yticks(yticks)
ax[2,4].set_yticklabels(ylabels)
ax[2,4].set_ylabel('')
ax[2,4].set_xlabel('Latitude, $^\circ$N',fontsize=12)
ax[2,4].set_title('')

#Control colorbar
p0 = ax[2,0].get_position().get_points().flatten()
p1 = ax[2,1].get_position().get_points().flatten()
p2 = ax[2,4].get_position().get_points().flatten()

cbar_ax = fig.add_axes([p0[0],0,p0[2]-p0[0],0.05])#1, 0.15, 0.05, 0.7])
cb1 = plt.colorbar(c1, orientation='horizontal',cax=cbar_ax,label='ms$^{-1}$')

#Difference of Difference colorbar
cbar_ax = fig.add_axes([p1[0],0,p2[2]-p1[0],0.05])
cb2 = plt.colorbar(c2, orientation='horizontal',cax=cbar_ax,label='Zonal wind speed, ms$^{-1}$')

ax[0,0].text(-60, 50, 'Dec', fontsize=14)
ax[1,0].text(-60, 50, 'Jan', fontsize=14)
ax[2,0].text(-60, 50, 'Feb', fontsize=14)
#plt.subplots_adjust(left=0.25)
#points.plot.contourf(yincrease=False, yscale='log',levels=21,colors='none',hatches=['...'],add_colorbar=False)

#fig.suptitle('3deg - Present Zonal Winds',fontsize=14)

plt.savefig("C:\\Users\\at18707\\OneDrive - University of Bristol\\Python\\Isca\\3deg\\50_ens\\zonal_djf_winds_3deg_minus_present_minus_control_c_da_dt_ns_q_vertical_profile.png", bbox_inches = "tight")

plt.show()
